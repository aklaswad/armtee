<html>
<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ace-builds@1.15.0/css/ace.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/destyle.css@4.0.0/destyle.min.css">
<style type="text/css" media="screen">
  body {
    color: #444;
    background-color: #f0f0f0;
  }
  #wrapper {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 16rem;
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
  }
  .editor-wrapper {
    background-color: #333;
    color: #777;
    position: relative;
    width: 100%;
    height: 100%;
  }
  #json, #tmpl, #out {
    position: absolute;
    width: 100%;
    height: calc(100% - 1rem);
    top: 1rem;
    left: 0;
    font-size: 1.1rem;
  }
  .editor-header {
    position: absolute;
    width: 100%;
    top: 0;
    padding: 0 1rem;
    margin: 0;
    font-size: 0.95rem;
  }
  #doc {
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: calc( 100% - 16rem );
    padding: 1rem;
  }
  h1 {
    font-size: 2rem;

  }
</style>
</head>
<body>
  <div id="wrapper">
    <div class="editor-wrapper">
      <div id="json">{
  "name": "ArmTee!",
  "items": [
    "Advanced",
    "Resig",
    "Micro",
    "Template",
    "Engine",
    "End"
  ]
}</div>
      <p class="editor-header">data</p>
    </div>
    <div class="editor-wrapper">
      <div id="tmpl">//% TAG <% %>
//% ROOT armtee
//! console.error('from template')
Thi${is} "armtee\\" &lt;%armtee.name%&gt;
Show `items`
//! armtee.items.forEach( item => {
//# comment: This shows list of items!!
//% TAG {{ }}
 - {{item}}
//! })</div>
      <p class="editor-header">template</p>
    </div>
    <div class="editor-wrapper">
      <div id="out"></div>
      <p class="editor-header">output</p>
    </div>
  </div>
  <div id="doc">
    <h1>armtee</h1>
    Line oriented text template tool
  </div>
</body>
</script>
<script src="./node_modules/ace-builds/src-min/ace.js"></script>
<script type="module">

  var editor = ace.edit("tmpl");
  editor.setTheme("ace/theme/pastel_on_dark");
  editor.session.setMode("ace/mode/markdown");
  var jsoneditor = ace.edit("json");
  jsoneditor.setTheme("ace/theme/pastel_on_dark");
  jsoneditor.session.setMode("ace/mode/json");
  var outeditor = ace.edit("out");
  outeditor.setTheme("ace/theme/pastel_on_dark");
  outeditor.session.setMode("ace/mode/json");
  outeditor.setReadOnly(true)

  import Armtee from './lib/armtee.js'
  Armtee.debug = 1
  const out = document.getElementById('out')

  function render() {
    const tmpl = editor.getValue()
    const json = jsoneditor.getValue()
    let data
    try {
      data = JSON.parse(json)
    }
    catch (e) {
      outeditor.setValue( 'Waiting for JSON format corrected' )
      return
    }
    try {
      const armtee = Armtee.fromText(tmpl, { file: 'fromtext' })
      outeditor.setValue( armtee.render(data) )
    }
    catch (e) {
      outeditor.setValue(e)
    }
    return
  }
  editor.session.on('change', render)
  jsoneditor.session.on('change', render)
  render()
//console.error(armtee.convert('hashy', 'logic'))
</script>
